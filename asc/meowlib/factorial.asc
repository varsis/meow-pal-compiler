################################################################################
# factorial(x) - calculates the factorial of x (Internal only)
################################################################################

# Test
#	READR
#	CALL	0, ml_factorial
#	!D
#	STOP

ml_factorial
	# i, result
	ADJUST	2

	# i = 1
	CONSTR	1.0
	POP	0[0]

	# result = 1
	CONSTR	1.0
	POP	0[0]

ml_factorial_loop
	# while (i <= x)	 
	PUSH	0[0]
	PUSH	-3[0]
	GTR
	NOT
	IFZ	ml_factorial_done

	# result = result * i
	PUSH	1[0]
	PUSH	0[0]
	MULR
	POP	1[0]

	# i = i + 1
	PUSH	0[0]
	CONSTR	1.0
	ADDR
	POP	0[0]
	GOTO	ml_factorial_loop

ml_factorial_done
	# retvalue = result
	PUSH	1[0]
	ITOR
	POP	-3[0]

	ADJUST	-2
	RET	0

